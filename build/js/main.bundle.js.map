{"version":3,"sources":["webpack://keksobooking/./source/js/photo.js","webpack://keksobooking/webpack/bootstrap","webpack://keksobooking/./source/js/utils.js","webpack://keksobooking/./source/js/modal.js","webpack://keksobooking/./source/js/card.js","webpack://keksobooking/./source/js/map.js","webpack://keksobooking/./source/js/form.js","webpack://keksobooking/./source/js/api.js","webpack://keksobooking/./source/js/main.js"],"names":["FILE_TYPES","avatarFileChooserElement","document","querySelector","avatarPreviewElement","photoFileChooserElement","photoPreviewElement","uploadPhoto","input","cb","addEventListener","file","files","fileName","name","toLowerCase","some","it","endsWith","reader","FileReader","readAsDataURL","src","result","style","backgroundImage","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","hideMessageModalByEscape","evt","key","isEscEvent","preventDefault","removeChild","removeEventListener","hideMessageModalByClick","showMessageModal","elementId","messageModal","content","cloneNode","classList","add","appendChild","OFFER_TYPE_DICTIONARY","palace","flat","house","bungalow","setElementParam","element","value","param","display","mainFormElement","mainFormFieldsetElements","querySelectorAll","mapFiltersFormElement","mapFiltersFormChildrenElements","children","BASED_LOCATION_X","BASED_LOCATION_Y","togglePageState","isNotActivated","remove","toFixed","forEach","fieldset","disabled","i","length","map","L","on","setView","lat","lng","tileLayer","attribution","addTo","mainPinIcon","icon","iconUrl","iconSize","iconAnchor","similarPinIcon","mainPinMarker","marker","draggable","target","getLatLng","renderSimilarPoints","ads","filteredAds","filter","ad","type","push","offer","price","rooms","Number","guests","features","checked","indexOf","every","el","slice","eachLayer","layer","Marker","removeLayer","point","location","bindPopup","cardElement","title","address","checkin","checkout","join","description","author","avatar","photosElement","imagesFragment","photos","imageTemplate","createDocumentFragment","img","createPhotosFragment","innerHTML","getCardElement","keepInView","formElement","typeInputElement","priceInputElement","minPrice","min","placeholder","checkinInputElement","checkoutInputElement","onCheckinCheckoutChange","this","roomNumberElement","capacityElement","onRoomNumberAndCapacitySelectChange","setCustomValidity","reportValidity","resetForm","reset","setLatLng","onSuccess","onFail","data","onMapFiltersChange","_","debounce","errorMessage","alert","fetch","then","response","json","catch","body","method","ok","createNewAd","FormData"],"mappings":"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","file":"main.bundle.js","sourcesContent":["const FILE_TYPES = ['gif', 'jpg', 'jpeg', 'png'];\n\nconst avatarFileChooserElement = document.querySelector('.ad-form-header__input');\nconst avatarPreviewElement = document.querySelector('.ad-form-header__preview img');\nconst photoFileChooserElement = document.querySelector('.ad-form__input');\nconst photoPreviewElement = document.querySelector('.ad-form__photo');\n\nconst uploadPhoto = (input, cb) => {\n  input.addEventListener('change', () => {\n    const file = input.files[0];\n    const fileName = file.name.toLowerCase();\n\n    const matches = FILE_TYPES.some((it) => {\n      return fileName.endsWith(it);\n    });\n\n    if (matches) {\n      const reader = new FileReader();\n\n      reader.addEventListener('load', () => cb(reader));\n\n      reader.readAsDataURL(file);\n    }\n  });\n}\n\nuploadPhoto(avatarFileChooserElement,(reader) => {\n  avatarPreviewElement.src = reader.result;\n});\nuploadPhoto(photoFileChooserElement, (reader) => {\n  photoPreviewElement.style.backgroundImage = `url(${reader.result})`;\n});\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// Функция генерации случайного числа с плавающей точкой из заданного диапазона с указанным \"количеством знаков после запятой\"\n// Источник: https://stackoverflow.com/questions/17726753/get-a-random-number-between-0-0200-and-0-120-float-numbers\nexport const getRandom = (min, max, power) =>\n  min >= 0 && max >= 0 && min < max ?\n    Number((Math.random() * (max - min) + min).toFixed(power)) :\n    null\n\n\n// Функция генерации случайного целого числа из заданного диапозона\nexport const getRandomInt = (min, max) => getRandom(min, max, 0)\n\nexport const isEscEvent = (evt) => {\n  return evt.key === 'Escape' || evt.key === 'Esc';\n};\n","import {isEscEvent} from './utils.js';\n\n// Функция, скрывающая модальное окно о результатах отправки формы\nconst hideMessageModalByEscape = function (evt) {\n  if (isEscEvent(evt)) {\n    evt.preventDefault();\n    document.querySelector('main').removeChild(document.querySelector('.notification-modal'));\n  }\n  document.removeEventListener('keydown', hideMessageModalByEscape);\n}\n\nconst hideMessageModalByClick = function () {\n  document.querySelector('main').removeChild(document.querySelector('.notification-modal'));\n  document.querySelector('.notification-modal').removeEventListener('click', hideMessageModalByClick);\n  if (document.querySelector('.error__button')) {\n    document.querySelector('.error__button').removeEventListener('click', hideMessageModalByClick);\n  }\n}\n\n// Функция, отображающая модальное окно о результатах отправки формы\nexport const showMessageModal = function (elementId) {\n  const template = document.querySelector(`#${elementId}`).content.querySelector('div');\n  const messageModal = template.cloneNode(true);\n  messageModal.classList.add('notification-modal');\n  document.querySelector('main').appendChild(messageModal);\n  document.addEventListener('keydown', hideMessageModalByEscape);\n  document.querySelector('.notification-modal').addEventListener('click', hideMessageModalByClick);\n\n  if (document.querySelector('.error__button')) {\n    document.querySelector('.error__button').addEventListener('click', hideMessageModalByClick);\n  }\n}\n","const OFFER_TYPE_DICTIONARY = {\n  palace: 'Дворец',\n  flat: 'Квартира',\n  house: 'Дом',\n  bungalow: 'Бунгало',\n};\n\nconst setElementParam = function (element, value, param = 'textContent') {\n  if (!value) {\n    element.style.display = 'none';\n  } else {\n    element[param] = value;\n  }\n}\n\n// Создание DOM-элементов фотографий для объявления\nconst createPhotosFragment = function (cardElement, photos) {\n  const imageTemplate = cardElement.querySelector('.popup__photos').querySelector('img');\n  const imagesFragment = document.createDocumentFragment();\n\n  for (let i = 0; i < photos.length; i++) {\n    const img = imageTemplate.cloneNode(true);\n    img.src = photos[i];\n    imagesFragment.appendChild(img);\n  }\n\n  return imagesFragment;\n}\n\n// // Функция, создающая DOM-элементы на основе сгенерированных объектов\nexport const getCardElement = function (point) {\n  const template = document.querySelector('#card').content.querySelector('article');\n  const cardElement = template.cloneNode(true);\n\n  setElementParam(cardElement.querySelector('.popup__title'), point.offer.title);\n  setElementParam(cardElement.querySelector('.popup__text--address'), point.offer.address);\n  setElementParam(cardElement.querySelector('.popup__text--price'),`${point.offer.price} ₽/ночь`);\n  setElementParam(cardElement.querySelector('.popup__type'), OFFER_TYPE_DICTIONARY[point.offer.type]);\n  setElementParam(cardElement.querySelector('.popup__text--capacity'), `${point.offer.rooms} комнаты для ${point.offer.guests} гостей`);\n  setElementParam(cardElement.querySelector('.popup__text--time'), `Заезд после  ${point.offer.checkin}, выезд до ${point.offer.checkout}`);\n  setElementParam(cardElement.querySelector('.popup__features'), point.offer.features.join(', '));\n  setElementParam(cardElement.querySelector('.popup__description'), point.offer.description);\n  setElementParam(cardElement.querySelector('.popup__avatar'), point.author.avatar, 'src');\n\n  const photosElement = cardElement.querySelector('.popup__photos');\n  const imagesFragment = createPhotosFragment(cardElement, point.offer.photos);\n\n  photosElement.innerHTML = '';\n  photosElement.appendChild(imagesFragment);\n\n  return cardElement;\n}\n","/* global L:readonly */\nimport {getCardElement} from './card.js';\n\nconst mainFormElement = document.querySelector('.ad-form');\nconst mainFormFieldsetElements = mainFormElement.querySelectorAll('fieldset');\nconst mapFiltersFormElement = document.querySelector('.map__filters');\nconst mapFiltersFormChildrenElements = mapFiltersFormElement.children;\nconst BASED_LOCATION_X = 35.6895000;\nconst BASED_LOCATION_Y = 139.6917100;\nconst MAP_ZOOM = 12;\nconst COUNT_OF_SIMILAR_ADS = 10;\n\nconst togglePageState = function (isNotActivated) {\n  if (isNotActivated) {\n    mainFormElement.classList.remove('ad-form--disabled');\n    mapFiltersFormElement.classList.remove('map__filters--disabled');\n    document.querySelector('#address').value = `${BASED_LOCATION_X.toFixed(5)}, ${BASED_LOCATION_Y.toFixed(5)}`;\n  } else {\n    mainFormElement.classList.add('ad-form--disabled');\n    mapFiltersFormElement.classList.add('map__filters--disabled');\n  }\n\n  mainFormFieldsetElements.forEach(fieldset => {\n    fieldset.disabled = !isNotActivated\n  });\n\n  for (let i = 0; i < mapFiltersFormChildrenElements.length; i++) {\n    mapFiltersFormChildrenElements[i].disabled = !isNotActivated;\n  }\n}\n\nconst deactivatePage = () => togglePageState (false);\nconst activatePage = () => togglePageState (true);\n\ndeactivatePage();\n\n// Добавление интерактивной карты\nconst map = L.map('map-canvas')\n  .on('load', activatePage) // Если карта успешно загрузилась, страница переходит в активное состояние)\n  .setView({lat: BASED_LOCATION_X, lng: BASED_LOCATION_Y}, MAP_ZOOM);\n\nL.tileLayer(\n  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  {\n    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n  },\n).addTo(map);\n\n// Задаёт кастомную главную метку\nconst mainPinIcon = L.icon({\n  iconUrl: 'img/main-pin.svg',\n  iconSize: [32, 32],\n  iconAnchor: [16, 32],\n});\n\nconst similarPinIcon = L.icon({\n  iconUrl: 'img/pin.svg',\n  iconSize: [32, 32],\n  iconAnchor: [16, 32],\n});\n\nexport const mainPinMarker = L.marker(\n  {\n    lat: BASED_LOCATION_X,\n    lng: BASED_LOCATION_Y,\n  },\n  {\n    draggable: true,\n    icon: mainPinIcon,\n  },\n);\n\nmainPinMarker.addTo(map);\n\n// Отслеживает перемещения главной метки и выводит текущие координаты в форму поиска\nmainPinMarker.on('moveend', (evt) => {\n  const {lat, lng} = evt.target.getLatLng();\n  document.querySelector('#address').value = `${lat.toFixed(5)}, ${lng.toFixed(5)}`;\n});\n\nconst filterSimilarAds = function (list) {\n  return list.filter(ad => {\n    const result = [];\n    const type = mapFiltersFormElement.querySelector('#housing-type').value;\n    if (type !== 'any') {\n      result.push(ad.offer.type === type)\n    }\n    const price = mapFiltersFormElement.querySelector('#housing-price').value;\n    if (price !== 'any') {\n      if (price === 'low') {\n        result.push(ad.offer.price < 10000)\n      }\n      if (price === 'middle') {\n        result.push( ad.offer.price > 10000 && ad.offer.price < 50000)\n      }\n      if (price === 'high') {\n        result.push(ad.offer.price > 50000)\n      }\n    }\n    const rooms = mapFiltersFormElement.querySelector('#housing-rooms').value;\n    if (rooms !== 'any') {\n      result.push(ad.offer.rooms === Number(rooms))\n    }\n    const guests = mapFiltersFormElement.querySelector('#housing-guests').value;\n    if (guests !== 'any') {\n      result.push(ad.offer.guests === Number(guests))\n    }\n    const features = mapFiltersFormElement.querySelectorAll('input[name=\"features\"]');\n    for (let i = 0; i < features.length; i++) {\n      if (features[i].checked) {\n        result.push(ad.offer.features.indexOf(features[i].value) !== -1)\n      }\n    }\n    return result.every(el => el === true);\n  }).slice(0, COUNT_OF_SIMILAR_ADS);\n}\n\n// Выводит на карту метки похожих объявлений\nexport const renderSimilarPoints = function (ads) {\n  const filteredAds = filterSimilarAds(ads)\n  map.eachLayer(function(layer) {\n    if (layer instanceof L.Marker && layer !== mainPinMarker) {\n      map.removeLayer(layer)\n    }\n  })\n  filteredAds.forEach((point) => {\n    const similarPinMarker = L.marker(point.location, {icon: similarPinIcon});\n\n    similarPinMarker.addTo(map).bindPopup(\n      getCardElement(point),\n      {keepInView: true}, // Поможет уместить всю карточку на карте, сохраняя в зоне видимости и передвигая карту\n    );\n  });\n}\n","import {showMessageModal} from './modal.js';\nimport {createNewAd} from './api.js';\nimport {mainPinMarker} from './map.js';\n\n// Меняет значение плейсхолдера и устанавливает минимальное значение для поля с ценой\nconst formElement = document.querySelector('.ad-form');\nconst typeInputElement = formElement.querySelector('#type')\nconst priceInputElement = formElement.querySelector('#price');\n\ntypeInputElement.addEventListener('change', function() {\n  const minPrice = {\n    palace: {\n      min: '10000',\n      placeholder: '10000',\n    },\n    house: {\n      min: '5000',\n      placeholder: '5000',\n    },\n    flat: {\n      min: '1000',\n      placeholder: '1000',\n    },\n    bungalow: {\n      min: '0',\n      placeholder: '0',\n    },\n  };\n\n  priceInputElement.min = minPrice[typeInputElement.value].min;\n  priceInputElement.placeholder = minPrice[typeInputElement.value].placeholder;\n});\n\n// Устанавливает сответствие между временем заселения и выезда\nconst checkinInputElement = formElement.querySelector('#timein');\nconst checkoutInputElement = formElement.querySelector('#timeout');\n\nconst onCheckinCheckoutChange = function () {\n  checkinInputElement.value = this.value\n  checkoutInputElement.value = this.value\n}\n\ncheckinInputElement.addEventListener('change', onCheckinCheckoutChange);\ncheckoutInputElement.addEventListener('change', onCheckinCheckoutChange);\n\n// Валидирует соответствие количества комнат количеству гостей\nconst roomNumberElement = formElement.querySelector('#room_number');\nconst capacityElement = formElement.querySelector('#capacity');\n\nconst onRoomNumberAndCapacitySelectChange = function () {\n  capacityElement.setCustomValidity('');\n\n  switch (roomNumberElement.value) {\n    case '1':\n      if (capacityElement.value === '2' || capacityElement.value === '3' || capacityElement.value === '0') {\n        capacityElement.setCustomValidity('Выбранное количество гостей не подойдёт для жилья с 1 комнатой');\n      }\n      break;\n    case '2':\n      if (capacityElement.value === '3' || capacityElement.value === '0') {\n        capacityElement.setCustomValidity('Выбранное количество гостей не подойдёт для жилья с 2 комнатами');\n      }\n      break;\n    case '3':\n      if (capacityElement.value === '0') {\n        capacityElement.setCustomValidity('Выбранное количество комнат подходит только для гостей');\n      }\n      break;\n    case '100':\n      if (capacityElement.value === '1' || capacityElement.value === '2' || capacityElement.value === '3') {\n        capacityElement.setCustomValidity('Выбранное количество комнат не подходит для гостей');\n      }\n      break;\n  }\n\n  capacityElement.reportValidity();\n}\n\nroomNumberElement.addEventListener('change', onRoomNumberAndCapacitySelectChange)\ncapacityElement.addEventListener('change', onRoomNumberAndCapacitySelectChange)\n\n// Меняет значения полей при сбросе формы\nconst BASED_LOCATION_X = 35.6895000;\nconst BASED_LOCATION_Y = 139.6917100;\n\nconst resetForm = () => {\n  formElement.reset();\n  document.querySelector('#price').placeholder = '1000';\n  document.querySelector('#address').value = `${BASED_LOCATION_X.toFixed(5)}, ${BASED_LOCATION_Y.toFixed(5)}`;\n  mainPinMarker.setLatLng({\n    lat: BASED_LOCATION_X,\n    lng: BASED_LOCATION_Y,\n  });\n}\n\ndocument.querySelector('.ad-form__reset').addEventListener('click', resetForm);\n\n// Отрисовывает сообщение об успешной отправке формы\nconst showSuccessNotification = function () {\n  showMessageModal('success');\n  resetForm();\n}\n\n// Отрисовывает сообщение о неудачной отправке формы\nconst showErrorNotification = function () {\n  showMessageModal('error');\n}\n\n// Отправляет форму с новым объявлением на сервер\nexport const setUserFormSubmit = () => {\n  formElement.addEventListener('submit', (evt) => {\n    evt.preventDefault();\n\n    createNewAd(\n      () => showSuccessNotification(),\n      () => showErrorNotification(),\n      new FormData(evt.target),\n    );\n  })\n}\n\nexport const onMapFiltersChange = (cb) => {\n  document.querySelector('#housing-type').addEventListener('change', cb)\n  document.querySelector('#housing-price').addEventListener('change', cb)\n  document.querySelector('#housing-rooms').addEventListener('change', cb)\n  document.querySelector('#housing-guests').addEventListener('change', cb)\n  const features = document.querySelectorAll('input[name=\"features\"]');\n  for (let i = 0; i < features.length; i++) {\n    features[i].addEventListener('change', cb)\n  }\n}\n\n\n","// Загружает похожие объявления с сервера\nexport const fetchSimilarAds = (onSuccess, onFail) => {\n  const errorMessage = 'При загрузке данных с сервера произошла ошибка. Не удалось загрузить похожие объявления!'\n  fetch('https://22.javascript.pages.academy/keksobooking/data')\n    .then((response) => response.json())\n    .then((data) => onSuccess(data))\n    .catch(() => {onFail(errorMessage)\n    });\n};\n\n// Отправляет новое объявление с данными из формы на сервер\nexport const createNewAd = (onSuccess, onFail, body) => {\n  const errorMessage = 'При создании нового объявления произошла ошибка. Не удалось создать объявление!'\n  fetch(\n    'https://22.javascript.pages.academy/keksobooking',\n    {\n      method: 'POST',\n      body,\n    },\n  )\n    .then((response) => {\n      if (response.ok) {\n        onSuccess(response.json());\n      } else {\n        onFail(errorMessage);\n      }\n    })\n    .catch(() => {\n      onFail(errorMessage);\n    });\n};\n\n","/* global _:readonly */\nimport {setUserFormSubmit, onMapFiltersChange} from './form.js';\nimport {fetchSimilarAds} from './api.js';\nimport {renderSimilarPoints} from './map.js';\nimport './photo.js';\n\nconst RERENDER_DELAY = 500;\n\nfetchSimilarAds(\n  (data) => {\n    renderSimilarPoints(data)\n    onMapFiltersChange(_.debounce(\n      () => renderSimilarPoints(data), RERENDER_DELAY,\n    ))\n  },\n  (errorMessage) => alert(errorMessage),\n)\n\nsetUserFormSubmit();\n"],"sourceRoot":""}